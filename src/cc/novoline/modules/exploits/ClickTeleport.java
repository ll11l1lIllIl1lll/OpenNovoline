package cc.novoline.modules.exploits;

import cc.novoline.events.EventTarget;
import cc.novoline.events.events.EventState;
import cc.novoline.events.events.MotionUpdateEvent;
import cc.novoline.events.events.MoveEvent;
import cc.novoline.gui.screen.setting.Manager;
import cc.novoline.gui.screen.setting.Setting;
import cc.novoline.gui.screen.setting.SettingType;
import cc.novoline.modules.AbstractModule;
import cc.novoline.modules.EnumModuleType;
import cc.novoline.modules.ModuleManager;
import cc.novoline.modules.combat.KillAura;
import cc.novoline.modules.configurations.annotation.Property;
import cc.novoline.modules.configurations.property.object.BooleanProperty;
import cc.novoline.modules.configurations.property.object.DoubleProperty;
import cc.novoline.modules.configurations.property.object.PropertyFactory;
import cc.novoline.modules.configurations.property.object.StringProperty;
import cc.novoline.modules.exploits.Blink;
import cc.novoline.utils.RotationUtil;
import cc.novoline.utils.Timer;
import cc.novoline.utils.notifications.NotificationType;
import java.util.Iterator;
import java.util.List;
import java.util.concurrent.CopyOnWriteArrayList;
import java.util.function.Supplier;
import net.minecraft.block.Block;
import net.minecraft.init.Blocks;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.client.C03PacketPlayer$C04PacketPlayerPosition;
import net.minecraft.network.play.client.C07PacketPlayerDigging;
import net.minecraft.network.play.client.C07PacketPlayerDigging$Action;
import net.minecraft.util.BlockPos;
import net.minecraft.util.EnumFacing;
import net.minecraft.util.MathHelper;
import net.minecraft.util.MovingObjectPosition;
import net.minecraft.util.MovingObjectPosition$MovingObjectType;
import net.minecraft.util.Vec3;
import org.jetbrains.annotations.NotNull;

public class ClickTeleport extends AbstractModule {
   private boolean niga;
   private List y = new CopyOnWriteArrayList();
   private Timer timer = new Timer();
   @Property("mode")
   private StringProperty z = PropertyFactory.createString("BlocksMC").acceptableValues(new String[]{"BlocksMC", "NCPNoTimer"});
   @Property("speed")
   private StringProperty B = PropertyFactory.createString("Instant").acceptableValues(new String[]{"Instant", "Delayed"});
   @Property("delay")
   private DoubleProperty A = (DoubleProperty)((DoubleProperty)PropertyFactory.createDouble(Double.valueOf(100.0D)).minimum(Double.valueOf(50.0D))).maximum(Double.valueOf(400.0D));
   @Property("damage")
   private BooleanProperty C = PropertyFactory.createBoolean(Boolean.valueOf(true));

   public ClickTeleport(@NotNull ModuleManager var1) {
      super(var1, "ClickTeleport", "Click Teleport", EnumModuleType.EXPLOITS, "lol");
      Manager.put(new Setting("CT_MODE", "Mode", SettingType.COMBOBOX, this, this.z));
      Blink.a();
      Manager.put(new Setting("CT_SPEED", "Speed", SettingType.COMBOBOX, this, this.B, this::lambda$new$0));
      Manager.put(new Setting("CT_DELAY", "Delay", SettingType.SLIDER, this, this.A, 10.0D, this::lambda$new$1));
      Manager.put(new Setting("CT_DAMAGE", "Damage", SettingType.CHECKBOX, this, this.C, this::lambda$new$2));
   }

   private Vec3 c() {
      return new Vec3(this.mc.player.posX, this.mc.player.posY + (double)this.mc.player.getEyeHeight(), this.mc.player.posZ);
   }

   public MovingObjectPosition getPosition() {
      float var1 = 999.0F;
      Vec3 var2 = this.c();
      Vec3 var3 = RotationUtil.getVectorForRotation(this.mc.player.rotationPitch, this.mc.player.rotationYaw);
      Vec3 var4 = var2.addVector(var3.xCoord * (double)var1, var3.yCoord * (double)var1, var3.zCoord * (double)var1);
      return this.mc.world.rayTraceBlocks(var2, var4, false, false, false);
   }

   public void onEnable() {
      this.y.clear();
      this.timer.reset();
      this.b();
   }

   @EventTarget
   public void a(MoveEvent var1) {
      int var2 = Blink.b();
      if(((String)this.z.get()).equals("BlocksMC") && ((String)this.B.get()).equals("Delayed") && !this.y.isEmpty()) {
         var1.setY(this.mc.player.motionY = 0.0D);
         var1.setMoveSpeed(0.0D);
      }

   }

   @EventTarget
   public void a(MotionUpdateEvent var1) {
      int var2 = Blink.b();
      if(var1.getState() == EventState.PRE && ((String)this.z.get()).equals("BlocksMC") && ((String)this.B.get()).equals("Delayed") && this.timer.delay(((Double)this.A.get()).doubleValue())) {
         if(!this.y.isEmpty()) {
            if(this.y.size() == 1) {
               this.mc.player.setPosition((double)((BlockPos)this.y.get(0)).getX(), (double)(((BlockPos)this.y.get(0)).getY() + 1), (double)((BlockPos)this.y.get(0)).getZ());
               this.toggle();
            }

            this.sendPacketNoEvent(new C03PacketPlayer$C04PacketPlayerPosition((double)((BlockPos)this.y.get(0)).getX(), (double)((BlockPos)this.y.get(0)).getY(), (double)((BlockPos)this.y.get(0)).getZ(), false));
            this.y.remove(0);
         }

         this.timer.reset();
      }

   }

   private void b() {
      int var1 = Blink.b();
      if(((String)this.z.get()).equals("NCPNoTimer")) {
         double var2 = this.mc.player.getBaseMoveSpeed();
         if(this.getPosition() != null) {
            if(this.getPosition().typeOfHit == MovingObjectPosition$MovingObjectType.BLOCK) {
               BlockPos var4 = this.getPosition().getBlockPos();
               double var5 = (double)var4.getX() + 0.5D;
               double var7 = (double)var4.getZ() + 0.5D;
               float var9 = RotationUtil.getYawToPoint(var5, var7);
               double var10 = Math.abs(this.mc.player.getDistance(var5, (double)var4.getY(), var7));
               double var12 = this.mc.player.posY;
               if(var2 < var10) {
                  double var16 = -Math.sin(Math.toRadians((double)var9)) * var2;
                  double var18 = Math.cos(Math.toRadians((double)var9)) * var2;
                  double var20 = 0.0D;
                  Vec3 var22 = this.getPositionForVector(this.mc.player.posX + var16, var12, this.mc.player.posZ + var18);
                  Vec3 var23 = RotationUtil.getVectorForRotation(90.0F, 0.0F);
                  Vec3 var24 = var22.addVector(var23.xCoord * 99.0D, var23.yCoord * 99.0D, var23.zCoord * 99.0D);
                  MovingObjectPosition var25 = this.mc.world.rayTraceBlocks(var22, var24, false, false, false);
                  if(var25 == null) {
                     this.novoline.getNotificationManager().pop("Can\'t teleport there!", 2000, NotificationType.ERROR);
                     return;
                  }

                  double var26 = 0.0D;
                  if(var26 < var2) {
                     Vec3 var28 = RotationUtil.getVectorForRotation(0.0F, var9);
                     Vec3 var29 = var22.addVector(var28.xCoord * var26, var28.yCoord * var26, var28.zCoord * var26);
                     MovingObjectPosition var30 = this.mc.world.rayTraceBlocks(var22, var29, false, false, false);
                     if(var30 != null && var30.typeOfHit == MovingObjectPosition$MovingObjectType.BLOCK) {
                        var20 = var26;
                     }

                     double var10000 = var26 + var2 / 100.0D;
                  }

                  Block var51 = this.mc.world.getBlockState(new BlockPos(this.mc.player.posX - Math.sin(Math.toRadians((double)var9)) * (var2 + var2), var12, this.mc.player.posZ + Math.cos(Math.toRadians((double)var9)) * (var2 + var2))).getBlock();
                  if(var20 > 0.0D && var51 != Blocks.tallgrass) {
                     double var27 = -Math.sin(Math.toRadians((double)var9)) * (var20 - 0.3D);
                     double var53 = Math.cos(Math.toRadians((double)var9)) * (var20 - 0.3D);
                     this.a(this.mc.player.posX + var16 + var27, var12, this.mc.player.posZ + var18 + var53);
                     double var31 = var51 == Blocks.air?0.5D:var51.getBlockBoundsMaxY() - var51.getBlockBoundsMinY();
                     double var33 = var31 - var12 % 1.0D;
                     if(var33 < 0.625D) {
                        this.a(this.mc.player.posX + var16 + var27, var12 + var33, this.mc.player.posZ + var18 + var53);
                     }

                     this.a(this.mc.player.posX + var16 + var27, var12 + 0.41999998688698D, this.mc.player.posZ + var18 + var53);
                     this.a(this.mc.player.posX + var16 + var27, var12 + 0.7531999805212D, this.mc.player.posZ + var18 + var53);
                     var12 += var33;
                  }

                  double var52 = 0.0D;
                  Vec3 var54 = this.getPositionForVector(this.mc.player.posX + var16, var12, this.mc.player.posZ + var18);
                  double var55 = 0.0D;
                  if(var55 < 99.0D) {
                     Vec3 var32 = RotationUtil.getVectorForRotation(90.0F, 0.0F);
                     Vec3 var59 = var54.addVector(var32.xCoord * var55, var32.yCoord * var55, var32.zCoord * var55);
                     MovingObjectPosition var34 = this.mc.world.rayTraceBlocks(var54, var59, false, false, false);
                     if(var34 != null && var34.typeOfHit == MovingObjectPosition$MovingObjectType.BLOCK) {
                        Block var35 = this.mc.world.getBlockState(var34.getBlockPos()).getBlock();
                        if(var35 != Blocks.tallgrass) {
                           var52 = MathHelper.incValue(MathHelper.b(var55, 3), 0.125D);
                        }
                     }

                     var55 = var55 + 1.0E-4D;
                  }

                  if(var52 > 0.0D) {
                     var55 = 0.0D;
                     Vec3 var58 = this.getPositionForVector(this.mc.player.posX + var16, var12 - 0.01D, this.mc.player.posZ + var18);
                     double var60 = 0.0D;
                     if(var60 < var2) {
                        Vec3 var63 = RotationUtil.getVectorForRotation(0.0F, var9);
                        Vec3 var36 = var58.addVector(var63.xCoord * var60, var63.yCoord * var60, var63.zCoord * var60);
                        MovingObjectPosition var37 = this.mc.world.rayTraceBlocks(var58, var36, false, false, false);
                        if(var37 != null && var37.typeOfHit != MovingObjectPosition$MovingObjectType.BLOCK) {
                           var55 = var60;
                        }

                        var60 = var60 + 0.001D;
                     }

                     var60 = -Math.sin(Math.toRadians((double)var9)) * (var55 + 0.5D);
                     double var64 = Math.cos(Math.toRadians((double)var9)) * (var55 + 0.5D);
                     this.a(this.mc.player.posX + var16 + var60, var12, this.mc.player.posZ + var18 + var64);
                     double var65 = 0.0D;
                     double var39 = 0.0D;
                     int var43 = 0;
                     if(var43 < 99) {
                        label1198: {
                           if(var65 < var52) {
                              var39 = var39 + 0.08D;
                              var39 = var39 * 0.980000019073486D;
                              var65 = var65 + var39;
                              double var41 = var12 - var65;
                              if(var65 >= var52) {
                                 break label1198;
                              }

                              this.a(this.mc.player.posX + var16 + var60, var41, this.mc.player.posZ + var18 + var64);
                           }

                           var12 -= var52;
                        }

                        ++var43;
                     }
                  }

                  this.a(this.mc.player.posX + var16, var12, this.mc.player.posZ + var18);
                  double var14 = var2 + var2;
               }

               this.mc.player.setPosition(var5, var12, var7);
            }

            this.toggle();
         }
      }

      if(((String)this.z.get()).equals("BlocksMC")) {
         MovingObjectPosition var44 = this.getPosition();
         if(var44 != null) {
            if(var44.typeOfHit != MovingObjectPosition$MovingObjectType.BLOCK) {
               return;
            }

            if(((Boolean)this.C.get()).booleanValue()) {
               this.sendPacketNoEvent(new C03PacketPlayer$C04PacketPlayerPosition(this.mc.player.posX, this.mc.player.posY + 3.0005123413124D, this.mc.player.posZ, false));
               this.sendPacketNoEvent(new C03PacketPlayer$C04PacketPlayerPosition(this.mc.player.posX, this.mc.player.posY, this.mc.player.posZ, false));
               this.sendPacketNoEvent(new C03PacketPlayer(true));
            }

            BlockPos var3 = var44.getBlockPos();
            double var45 = Math.abs(this.mc.player.posX - (double)var3.getX());
            double var6 = Math.abs(this.mc.player.posZ - (double)var3.getZ());
            double var8 = Math.hypot(var45, var6);
            double var46 = this.mc.player.posY - (double)var3.getY();
            int var47 = 0;
            if((double)var47 < var8) {
               if(var47 % 7 == 0) {
                  double var13 = -Math.sin(Math.toRadians((double)this.mc.player.rotationYaw)) * (double)var47;
                  double var15 = Math.cos(Math.toRadians((double)this.mc.player.rotationYaw)) * (double)var47;
                  this.y.add(new BlockPos(this.mc.player.posX + var13, this.mc.player.posY, this.mc.player.posZ + var15));
               }

               ++var47;
            }

            this.y.add(var3);
            if(((String)this.B.get()).equals("Instant")) {
               Iterator var49 = this.y.iterator();
               if(var49.hasNext()) {
                  BlockPos var50 = (BlockPos)var49.next();
                  if(this.y.indexOf(var50) == this.y.size() - 1) {
                     this.mc.player.setPosition((double)var50.getX(), (double)(var50.getY() + 1), (double)var50.getZ());
                     this.toggle();
                  }

                  this.sendPacketNoEvent(new C03PacketPlayer$C04PacketPlayerPosition((double)var50.getX(), (double)var50.getY(), (double)var50.getZ(), false));
               }
            }
         }

         this.toggle();
      }

   }

   private void a(double var1, double var3, double var5) {
      int var7 = Blink.b();
      if(this.isEnabled(KillAura.class) && ((KillAura)this.getModule(KillAura.class)).shouldBlock()) {
         this.sendPacketNoEvent(new C07PacketPlayerDigging(C07PacketPlayerDigging$Action.RELEASE_USE_ITEM, BlockPos.ORIGIN, EnumFacing.DOWN));
      }

      this.sendPacketNoEvent(new C03PacketPlayer$C04PacketPlayerPosition(var1, var3, var5, this.mc.player.c(var3)));
   }

   public Vec3 getPositionForVector(double var1, double var3, double var5) {
      return new Vec3(var1, var3, var5);
   }

   private Boolean lambda$new$2() {
      return Boolean.valueOf(((String)this.z.get()).equals("BlocksMC"));
   }

   private Boolean lambda$new$1() {
      int var1 = Blink.a();
      return Boolean.valueOf(((String)this.z.get()).equals("BlocksMC") && ((String)this.B.get()).equals("Delayed"));
   }

   private Boolean lambda$new$0() {
      return Boolean.valueOf(((String)this.z.get()).equals("BlocksMC"));
   }
}
