//package cc.novoline.modules.exploits;
//
//import cc.novoline.events.EventTarget;
//import cc.novoline.events.events.LoadWorldEvent;
//import cc.novoline.events.events.PacketEvent;
//import cc.novoline.events.events.PlayerUpdateEvent;
//import cc.novoline.modules.AbstractModule;
//import cc.novoline.modules.EnumModuleType;
//import cc.novoline.modules.ModuleManager;
//import cc.novoline.modules.combat.KillAura;
//import cc.novoline.modules.player.Freecam;
//import cc.novoline.utils.notifications.NotificationType;
//import net.minecraft.entity.Entity;
//import net.minecraft.network.play.client.C03PacketPlayer;
//import net.minecraft.network.play.client.C0BPacketEntityAction;
//import net.minecraft.network.play.client.C0CPacketInput;
//import net.minecraft.network.play.client.CPacketVehicleMove;
//import org.checkerframework.checker.nullness.qual.NonNull;
//import viaversion.viafabric.ViaFabric;
//
//public class EntityDesync extends AbstractModule {
//
//    private Entity ridingEntity;
//
//    public EntityDesync(@NonNull ModuleManager novoline) {
//        super(novoline, EnumModuleType.EXPLOITS, "EntityDesync", "Entity Desync");
//    }
//
//    @Override
//    public void onEnable() {
//        if (mc.player != null) {
//            if (ViaFabric.clientSideVersion != novoline.viaVersion()) {
//                novoline.getNotificationManager().pop(getDisplayName(), "Please switch the protocol to 1.13.2", NotificationType.WARNING);
//                toggle();
//                return;
//            }
//        }
//
//        if (mc.player.isRiding()) {
//            ridingEntity = mc.player.ridingEntity;
//            mc.player.dismountEntity(mc.player.ridingEntity);
//            mc.world.removeEntityFromWorld(mc.player.ridingEntity.getEntityID());
//        }
//    }
//
//    @Override
//    public void onDisable() {
///*        if (mc.world != null && ridingEntity != null) {
//            sendPacketNoEvent(new C0CPacketInput(mc.player.moveStrafing, mc.player.moveForward, mc.player.movementInput().jump(), true));
//            mc.renderGlobal.loadRenderers();
//            ridingEntity = null;
//        }*/
//    }
//
//    @EventTarget
//    public void onUpdate(PlayerUpdateEvent event) {
//        if (ridingEntity != null) {
//            sendPacketNoEvent(new C03PacketPlayer.C05PacketPlayerLook(mc.player.rotationYaw, mc.player.rotationPitch, false));
//            sendPacketNoEvent(new C0CPacketInput(mc.player.moveStrafing, mc.player.moveForward, mc.player.movementInput().jump(), false));
//
//            if (isEnabled(KillAura.class) && getModule(KillAura.class).shouldAttack()) {
//                KillAura killAura = getModule(KillAura.class);
//                Entity target = killAura.getTarget();
//                sendPacketNoEvent(new CPacketVehicleMove(target.posX, target.posY, target.posZ, killAura.getIYaw(), killAura.getIPitch()));
//
//            } else {
//                if (isEnabled(Teleport.class)) {
//                    Entity teleport = getModule(Teleport.class).getTeleportEntity();
//                    sendPacketNoEvent(new CPacketVehicleMove(teleport.posX, teleport.posY + 1, teleport.posZ, teleport.rotationYaw, teleport.rotationPitch));
//                } else if (isEnabled(Freecam.class)) {
//                    Entity freecam = getModule(Freecam.class).getFreecamEntity();
//                    sendPacketNoEvent(new CPacketVehicleMove(freecam.posX, freecam.posY + 1, freecam.posZ, freecam.rotationYaw, freecam.rotationPitch));
//                } else {
//                    sendPacketNoEvent(new CPacketVehicleMove(mc.player.posX, mc.player.posY + 1, mc.player.posZ, mc.player.rotationYaw, mc.player.rotationPitch));
//                }
//            }
//        }
//    }
//
//    @EventTarget
//    public void onPacket(PacketEvent event) {
//        if (ridingEntity != null) {
//            if (event.getState().equals(PacketEvent.State.OUTGOING)) {
//                if (event.getPacket() instanceof C0BPacketEntityAction) {
//                    C0BPacketEntityAction packet = (C0BPacketEntityAction) event.getPacket();
//
//                    if (packet.getAction().equals(C0BPacketEntityAction.Action.START_SNEAKING) ||
//                            packet.getAction().equals(C0BPacketEntityAction.Action.STOP_SNEAKING)) {
//                        event.setCancelled(true);
//                    }
//                }
//
//                if (event.getPacket() instanceof C03PacketPlayer) {
//                    event.setCancelled(true);
//                }
//            }
//        }
//    }
//
//    @EventTarget
//    public void onLoadWorld(LoadWorldEvent event) {
//        toggle();
//    }
//
//    public Entity getRidingEntity() {
//        return ridingEntity;
//    }
//
//    public boolean isDesynced() {
//        return isEnabled() && ridingEntity != null;
//    }
//}
//
